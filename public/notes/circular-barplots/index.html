<!DOCTYPE html>
<html lang="en-us">
<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="theme" content="hugo-academic">
  <meta name="generator" content="Hugo 0.37.1" />
  <meta name="author" content="VP Nagraj">

  
  
  
  
    
      
    
  
  <meta name="description" content="While preparing figures for a manuscript recently, the first author proposed a plot to compare several phenotypes from every donor in the study. One suggestion was a series of circular barplots (normalized since each phenotype was on a different scale) side-by-side.
Using ggplot2 that might look something like this:
library(ggplot2) library(tidyr) library(dplyr) msleep %&gt;% select(name,sleep_total,brainwt,bodywt) %&gt;% filter(complete.cases(.)) %&gt;% gather(key,value, -name) %&gt;% group_by(key) %&gt;% mutate(value = percent_rank(value)) %&gt;% ggplot(aes(name,value)) &#43; geom_col() &#43; coord_polar() &#43; facet_wrap(~ key, ncol = 3) &#43; labs(x = NULL, y = &quot;Percentile&quot;) &#43; theme_minimal() The figure isn’t easy to interpret in this configuration.">

  
  <link rel="alternate" hreflang="en-us" href="/notes/circular-barplots/">

  


  

  
  
  <meta name="theme-color" content="#0095eb">
  
  
  
  
    
  
  
    
    
      
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
      
    
  
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha512-6MXa8B6uaO18Hid6blRMetEIoPqHf7Ux1tnyIQdpt9qI5OACx7C+O3IVTr98vwGnlcg0LOLa02i9Y1HpVhlfiw==" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.1/css/academicons.min.css" integrity="sha512-NThgw3XKQ1absAahW6to7Ey42uycrVvfNfyjqcFNgCmOCQ5AR4AO0SiXrN+8ZtYeappp56lk1WtvjVmEa+VR6A==" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha512-SfTiTlX6kk+qitfevl/7LibUOeJWlt9rbyDn92a1DqWOw9vWG2MFoays0sgObmWazO5BQPiFucnnEAjpAB+/Sw==" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.css" integrity="sha256-ygkqlh3CYSUri3LhQxzdcm0n1EQvH2Y+U5S2idbLtxs=" crossorigin="anonymous">
  
  
  
  
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Montserrat:400,700%7cRoboto:400,400italic,700%7cRoboto&#43;Mono">
  
  <link rel="stylesheet" href="/styles.css">
  

  

  
  <link rel="alternate" href="/index.xml" type="application/rss+xml" title="VP Nagraj">
  <link rel="feed" href="/index.xml" type="application/rss+xml" title="VP Nagraj">
  

  <link rel="manifest" href="/site.webmanifest">
  <link rel="icon" type="image/png" href="/img/icon.png">
  <link rel="apple-touch-icon" type="image/png" href="/img/icon-192.png">

  <link rel="canonical" href="/notes/circular-barplots/">

  <meta property="twitter:card" content="summary_large_image">
  
  <meta property="twitter:site" content="@vpnagraj">
  <meta property="twitter:creator" content="@vpnagraj">
  
  <meta property="og:site_name" content="VP Nagraj">
  <meta property="og:url" content="/notes/circular-barplots/">
  <meta property="og:title" content="Circular Barplots | VP Nagraj">
  <meta property="og:description" content="While preparing figures for a manuscript recently, the first author proposed a plot to compare several phenotypes from every donor in the study. One suggestion was a series of circular barplots (normalized since each phenotype was on a different scale) side-by-side.
Using ggplot2 that might look something like this:
library(ggplot2) library(tidyr) library(dplyr) msleep %&gt;% select(name,sleep_total,brainwt,bodywt) %&gt;% filter(complete.cases(.)) %&gt;% gather(key,value, -name) %&gt;% group_by(key) %&gt;% mutate(value = percent_rank(value)) %&gt;% ggplot(aes(name,value)) &#43; geom_col() &#43; coord_polar() &#43; facet_wrap(~ key, ncol = 3) &#43; labs(x = NULL, y = &quot;Percentile&quot;) &#43; theme_minimal() The figure isn’t easy to interpret in this configuration.">
  <meta property="og:locale" content="en-us">
  
  <meta property="article:published_time" content="2019-06-16T17:14:59&#43;00:00">
  
  <meta property="article:modified_time" content="2019-06-16T17:14:59&#43;00:00">
  

  
  
  <meta name="google-site-verification" content="ppzo6np2j0dwXjWa2KEyLd5as2Xd76FoUhT1cXtCbW4" />

  <title>Circular Barplots | VP Nagraj</title>

</head>
<body id="top" data-spy="scroll" data-target="#toc" data-offset="71" >

<nav class="navbar navbar-default navbar-fixed-top" id="navbar-main">
  <div class="container">

    
    <div class="navbar-header">
      
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
              data-target=".navbar-collapse" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      
      <a class="navbar-brand" href="/">VP Nagraj</a>
    </div>

    
    <div class="collapse navbar-collapse">

      
      
      <ul class="nav navbar-nav navbar-right">
        

        
        
        
        
        

        <li class="nav-item">
          <a href="/">
            
            <span>Home</span>
            
          </a>
        </li>

        
        

        
        
        
        
        
          
        

        <li class="nav-item">
          <a href="/about/bio">
            
            <span>About</span>
            
          </a>
        </li>

        
        

        
        
        
        
        
          
        

        <li class="nav-item">
          <a href="/notes">
            
            <span>Notes</span>
            
          </a>
        </li>

        
        

        
        
        
        
        
          
        

        <li class="nav-item">
          <a href="/publication">
            
            <span>Publications</span>
            
          </a>
        </li>

        
        
      

      
      </ul>

    </div>
  </div>
</nav>


<article class="article" itemscope itemtype="http://schema.org/Article">

  


  <div class="article-container">
    <h1 itemprop="name">Circular Barplots</h1>

<div class="article-metadata">

  <span class="article-date">
    
    <time datetime="2019-06-16 17:14:59 &#43;0000 &#43;0000" itemprop="datePublished dateModified">
      Jun 16, 2019
    </time>
  </span>
  <span itemscope itemprop="author publisher" itemtype="http://schema.org/Person">
    <meta itemprop="name" content="VP Nagraj">
  </span>

  
  <span class="middot-divider"></span>
  <span class="article-reading-time">
    4 min read
  </span>
  

  
  

  
  
  
  <span class="middot-divider"></span>
  <span class="article-categories">
    <i class="fa fa-folder"></i>
    
    <a href="/categories/notes">notes</a
    >
    
  </span>
  
  

</div>

    <div class="article-style" itemprop="articleBody">
      <p>While preparing figures for a manuscript recently, the first author proposed a plot to compare several phenotypes from every donor in the study. One suggestion was a series of circular barplots (normalized since each phenotype was on a different scale) side-by-side.</p>
<p>Using <code>ggplot2</code> that might look something like this:</p>
<pre class="r"><code>library(ggplot2)
library(tidyr)
library(dplyr)

msleep %&gt;%
  select(name,sleep_total,brainwt,bodywt) %&gt;%
  filter(complete.cases(.)) %&gt;%
  gather(key,value, -name) %&gt;%
  group_by(key) %&gt;%
  mutate(value = percent_rank(value)) %&gt;%
  ggplot(aes(name,value)) +
  geom_col() +
  coord_polar() +
  facet_wrap(~ key, ncol = 3) +
  labs(x = NULL,
       y = &quot;Percentile&quot;) +
  theme_minimal()</code></pre>
<p><img src="/notes/circular-barplots_files/figure-html/unnamed-chunk-1-1.png" width="672" /></p>
<p>The figure isn’t easy to interpret in this configuration. Even if the canvases of each of the facets were bigger, the labels would need to be rotated for legibility. With that done, it may still be hard to visually connect phenotypes across individuals. In this example, you have to squint at all three facets consecutively, and even do some jumping back and forth. Eventually you may see that some of the largest animals (in terms of both brain and body weight) actually rank quite low in terms of total sleep … and vice versa.</p>
<p>One alternative is to plot the bars as concentric circles, with the bars for phenotypes lined up at each individual.</p>
<p>This is where I stepped away from <code>ggplot2</code> and started using the <a href="https://cran.r-project.org/web/packages/circlize/index.html"><code>circlize</code> package</a>. The syntax took some getting used to … but overall I found the package to be quite useful. There was plenty of documentation in <a href="https://jokergoo.github.io/circlize_book/book/index.html">the <code>circlize</code> book</a>. And I was able to build on some of the examples to get where I needed to go:</p>
<pre class="r"><code>library(circlize)
library(ComplexHeatmap)
library(gridBase)
library(ggplot2)
library(tidyr)
library(dplyr)

sleep_size &lt;-
  msleep %&gt;%
  select(name,sleep_total,brainwt,bodywt) %&gt;%
  filter(complete.cases(.)) %&gt;%
  mutate(sleep_total = percent_rank(sleep_total),
         brainwt = percent_rank(brainwt),
         bodywt = percent_rank(bodywt),
         index = 1) %&gt;%
  arrange(desc(sleep_total)) %&gt;%
  mutate(name = factor(name))

sleep_size$name &lt;- factor(sleep_size$name, 
                          levels = as.character(sleep_size$name))</code></pre>
<pre class="r"><code># barplot colors
barcols  &lt;- c(&quot;firebrick&quot;,&quot;steelblue&quot;,&quot;goldenrod&quot;)

# parameters for each of the concentric plots
circos.par(cell.padding = c(0.02, 0, 0.02, 0),
           gap.after = c(rep(1, nrow(sleep_size)-1), 20),
           start.degree = 80,
           track.height = 0.3)

# initialize
# at each level of the factor (in this case animal name) plot at index (x=1 for all animals)
# make sure the limit is set to give room one either side of x for each plot
circos.initialize(factors = sleep_size$name, 
                  x = sleep_size$index, 
                  xlim = c(0,2))</code></pre>
<pre class="r"><code># create &quot;track&quot; region for and add lines for with y values for scaled sleep total
circos.trackPlotRegion(factors = sleep_size$name, 
                       y = sleep_size$sleep_total, 
                       panel.fun = function(x, y) {
  
  name = get.cell.meta.data(&quot;sector.index&quot;)
  i = get.cell.meta.data(&quot;sector.numeric.index&quot;)
  xlim = get.cell.meta.data(&quot;xlim&quot;)
  ylim = get.cell.meta.data(&quot;ylim&quot;)
  
  #text direction (dd) and adjusmtents (aa)
  theta = circlize(mean(xlim), 1.3)[1, 1] %% 360
  dd &lt;- ifelse(theta &lt; 90 || theta &gt; 270, &quot;clockwise&quot;, &quot;reverse.clockwise&quot;)
  aa = c(1, 0.5)
  if(theta &lt; 90 || theta &gt; 270)  aa = c(0, 0.5)
  
  #plot country labels
  circos.text(x=mean(xlim), y=1.2, labels=name, facing = dd, cex=0.6,  adj = aa)
  
  #plot main sector
  
  circos.axis(labels=FALSE, major.tick=FALSE)
  circos.yaxis(side = &quot;left&quot;, at = seq(0, 1, by = 0.25),
               sector.index = get.all.sector.index()[1], labels.cex = 0.4, labels.niceFacing = FALSE)
  
})

circos.trackLines(factors = sleep_size$name, 
                  x = sleep_size$index, 
                  y = sleep_size$sleep_total, 
                  pch=20, 
                  cex=2, 
                  col = barcols[1],
                  type=&quot;h&quot;, 
                  lwd = 6)</code></pre>
<pre class="r"><code># ... same as above but for body weight
circos.trackPlotRegion(factors = sleep_size$name, 
                       y = sleep_size$bodywt, 
                       panel.fun = function(x, y) {
                         
  circos.axis(labels=FALSE, major.tick=FALSE)
                         
})

circos.trackLines(factors = sleep_size$name, 
                  x = sleep_size$index, 
                  y = sleep_size$bodywt, 
                  pch=20, 
                  cex=2, 
                  col = barcols[2],
                  type=&quot;h&quot;, 
                  lwd = 4)</code></pre>
<pre class="r"><code># ... same as above but for brain weight
circos.trackPlotRegion(factors = sleep_size$name, 
                       y = sleep_size$brainwt, 
                       panel.fun = function(x, y) {
                         
  circos.axis(labels=FALSE, major.tick=FALSE)
                         
})

circos.trackLines(factors = sleep_size$name, 
                  x = sleep_size$index, 
                  y = sleep_size$brainwt, 
                  pch=20, 
                  cex=2, 
                  col = barcols[3],
                  type=&quot;h&quot;, 
                  lwd = 2)</code></pre>
<pre class="r"><code>circos.clear()</code></pre>
<pre class="r"><code># add legend using complex heatmap
# http://jokergoo.github.io/blog/html/add_legend_to_circlize.html
lgd_lines = Legend(at = colnames(sleep_size)[2:4],
                   type = &quot;lines&quot;,
                   legend_gp = gpar(col = barcols, lwd = 2),
                   title_position = &quot;topleft&quot;,
                   labels_gp = gpar(fontsize = 14, lex = 4),
                   title = &quot;Phenotype&quot;)

lgd_list_vertical = packLegend(lgd_lines)


pushViewport(viewport(x = unit(10, &quot;mm&quot;), y = unit(4, &quot;mm&quot;),
                      width = grobWidth(lgd_list_vertical),
                      height = grobHeight(lgd_list_vertical),
                      just = c(&quot;left&quot;, &quot;bottom&quot;)))

grid.draw(lgd_list_vertical)
upViewport()</code></pre>
<p><img src="/img/sleep_bar.png" /></p>

    </div>

    


<div class="article-tags">
  
  <a class="btn btn-primary btn-outline" href="/tags/circlize">circlize</a>
  
  <a class="btn btn-primary btn-outline" href="/tags/r">R</a>
  
  <a class="btn btn-primary btn-outline" href="/tags/ggplot2">ggplot2</a>
  
</div>




    
    
    <div class="article-widget">
      <div class="hr-light"></div>
      <h3>Related</h3>
      <ul>
        
        <li><a href="/notes/data-based-labels/">Data-Based Labels</a></li>
        
        <li><a href="/notes/transparent-background-with-ggplot2/">Transparent ggplot2 Plot Backgrounds</a></li>
        
        <li><a href="/notes/summary-se/">summary_se()</a></li>
        
        <li><a href="/notes/single-app-shiny-server/">Hosting a Single App with Shiny Server</a></li>
        
        <li><a href="/notes/rstudioconf2019/">rstudio::conf 2019</a></li>
        
      </ul>
    </div>
    

    

    


  </div>
</article>

<footer class="site-footer">
  <div class="container">
    <p class="powered-by">

      &copy; 2018 &middot; 

      Powered by the
      <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> for
      <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.

      <span class="pull-right" aria-hidden="true">
        <a href="#" id="back_to_top">
          <span class="button_icon">
            <i class="fa fa-chevron-up fa-2x"></i>
          </span>
        </a>
      </span>

    </p>
  </div>
</footer>


<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close btn-large" data-dismiss="modal">&times;</button>
        <h4 class="modal-title">Cite</h4>
      </div>
      <div>
        <pre><code class="modal-body tex"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-primary btn-outline js-copy-cite" href="#" target="_blank">
          <i class="fa fa-copy"></i> Copy
        </a>
        <a class="btn btn-primary btn-outline js-download-cite" href="#" target="_blank">
          <i class="fa fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

    

    
    

    

    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js" integrity="sha512-3P8rXCuGJdNZOnUx/03c1jOTnMn3rP63nBip5gOP2qmUh5YAdVAvFZ1E+QLZZbC1rtMrQb+mah3AfYW11RUrWA==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.3/imagesloaded.pkgd.min.js" integrity="sha512-umsR78NN0D23AzgoZ11K7raBD+R6hqKojyBZs1w8WvYlsI+QuKRGBx3LFCwhatzBunCjDuJpDHwxD13sLMbpRA==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha512-iztkobsvnjKfAtTNdHkGVjAYTrrtlC7mGp/54c40wowO7LhURYl3gVzzcEqGl/qKXQltJ2HwMrdLcNUdo+N/RQ==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.4/isotope.pkgd.min.js" integrity="sha512-VDBOIlDbuC4VWxGJNmuFRQ0Li0SKkDpmGyuhAG5LTDLd/dJ/S0WMVxriR2Y+CyPL5gzjpN4f/6iqWVBJlht0tQ==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.js" integrity="sha256-X5PoE3KU5l+JcX+w09p/wHl9AzK333C4hJ2I9S5mD4M=" crossorigin="anonymous"></script>
    
    
    <script src="/js/hugo-academic.js"></script>
    

    
    
      
      
      <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js" integrity="sha256-/BfiIkHlHoVihZdc6TFuj7MmJ0TWcWsMXkeDFwhi0zw=" crossorigin="anonymous"></script>
      

      

      

      <script>hljs.initHighlightingOnLoad();</script>
    

    
    

  </body>
</html>

